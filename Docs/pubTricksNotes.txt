PubTricks

Goal:  Good looking live site to demo for .NET
		Today (Monday)
			Structure
			Watch videos again
			Build on the way
			
TDD!
	Keep presentation notes

	Web Platform Installer
		Azure SDK1.5
		

Elevator Speech
	"Pubtricks is where simply remembered and awesome pub tricks are captured on video, and offered to our users"

	go live:  Friday I want site up.
		
Platform
	ASP.NET MVC3 (becuase I know this toolstack)
	Azure


What do I need to do?
	
	
c:\dev\PubTricks - easy to get to
\Docs
\Lib - all 3rd party binaries
\Source

File new project
	PubTricks.Azure.. create a folder.. 
	Add in PubTricks.Web as MVC3 role
	
Add to source control
	git init
	put in .gitIgnore file
	git add .
	git add -am "Load"
	
Add a dropbox backup
	mkdir e:\dropbox\repositories\ptricks
	git remote add origin e:/dropbox/repositories/ptricks
	cd e:\dropbox\repositories\ptricks
	git init --bare
	git push origin master (from c:\dev\pubtricks)
	
	
Task Runner project - console app.

Rename Files
	Public
		Scripts to javascripts
	
fix links
CDN's
	
Publish to Azure
	Why Azure?  Why not.
	
Logging
	setup NLog.config to output to app_data/logs/ file.
	extract interface
	
IoC - Ninject

Dependency Injection pattern - put logger in home controller

Membership

TDD/BDD

Nunit

TestDriven.NET
	Alt T, and Alt D

CodeSnippets Manager

GIT 
	IDE link
	feature branch
	  git branch
	  git checkout -b membership


	
First Test - a_new_trick_should_be_saved_to_db_on_save()
	
SQL Server
Tricks
	ID
	Name
	Description
	VideoURL
	DateCreated
	  
Get writing to db working using Massive
	  
Clear database before every test 
	setup
	  
getting logging working on the test projects
		directory isn't quite right.. 

		
Membership was a bit harder than it should be.
		
----
Design - Video 3

	3 themese for USD70
		biznizz
		inspire
		Apz
		

Elevator Speech
	"Pubtricks is where simply remembered and awesome pub tricks are captured on video, and offered to our users"
	
Website Front End User Stories:
	As a person going to the pub, I want an easy trick to remember so that I can entertain my friends
	
	As a returning user of the site I want to see if there are any new videos
	
	As a person going to the pub I want to see what is the highest rated trick 
	
	
	As a parent going to the pub with children, I want a kid friendly trick so I can keep them happy, and they can show their friends
	
	As a random browser of the site I want to understand immediately what the site is for
	
	As a smartphone user in the pub, I want to be able to check out tricks on video so I can be awesome in front of friends
	

Development User Stories
	As a presenter I want a polished front end site that has wow factor
	
	As a business apps developer I want a good back end including crud, validation and testing, so I can reuse learning

	
Other Sites
	youtube.com
	
	
Front End Features:
	Had a feedback tab thing
	
	Email me when anohter trick is published
	
	Newsletter

	Ability to upload pub tricks
	
Back End Features
	easily crud tricks
	easily manage whole system

	
http://www.woothemes.com/2011/08/swatch/   - free one

Bought a theme
	made in Wordpress
	got it working 
	copied html
	refactored css and js
	got it rendering
	

making theme into what I want layout to be like and refactoring to make simpler

/
	latest
	mostPopular

/category/comedy
/category/kids

/category/all
	
/trick/uncross-your-arms
/trick/the-kids-pen-trick


helpers and functions - great and easy
	getting a compile error when put on Azure
		[didn't work]try redploy whole thing
		[yes]works locally in Azure
		[yes]works on Azure when I comment out
		[no]try rename helper method to QuotesHelper
		look for other helpers
		@helper UserHelper(string quote) {
			<div class="quote">
				@*@Scrub(quote)*@
				@quote
			</div>    
		}\
		[properties tag wasn't set to output as content]
	

**Keith - how does he remember likes?	
**site to Phil - up to date?
**site off to Keith for front end feedback

--------
Data - Video 4

Baby steps to get things right.	
	
A user views a Trick video and reveal video 
A Trick can be in a Category
	

Write tests to help guide thinking
	**this is really good**

Then share with team and get feedback


ORM
	EF
		Guids as PK's.... Rob doesn't like
	MVC Scaffolding
	Massive
	

Controlers - RESTfully

Developing up /tricks controller
	Doing it manually
	
	Templates changing

Using own html helper methods
	
	
validation thoughts

front end wire in
like functionality

authentication wire in for admin

build out test cases and look for edge cases 
get lots of content on the site!	

contact page.
---------------
Massive

getting into the heart of it and stripping it back

get tests passing again

build up Massive from the ground

get controller working simply with no cruddy abstraction.

Create
	Votes in database isn't going through from create to db
	Likes on screen, but @Model.Votes in view.
	FormCollection is coming though as Likes
	
Create not working in VidPub original
	download again.
	not working in downloaded version

----
See what Rob has to say in Video5
	
unobtrusive validation

authentication on controller


make front end pull from database tricks table
	simple razor syntax

why js?  Write less server code, and write a more compelling and responsive application.

jquery templates to help display on the frontend?
	
make an ApplicationController to handle auth?

--------------
TODO - Monday
[doing]CName

[done]1. details page
		/tricks/2   - goes to a trick with ID of 2
		/tricks/pen-trick  - goes to a trick with ID of 2 (with magic happening - this is the name of the trick)
		
		/tricks - shows all tricks
		/categories/kids - shows all tricks in the category kids
		
		
		/admin/tricks/create
		/admin/tricks/delete
		/admin/tricks/edit/2
		/admin/categories/edit/5 - Kids category edit 
		
TODO Tuesday
	Review and see where I'm going - Develop apps fast which are what user needs, are testable, and we can deliver in stages as requirements change
														Entrepreneurial style.  Simple is good.
														
		Projects I'm going to be working on:
			PocketVouchers - lots of tables.. want to know the app is working, want to know when it slows down on live!
			FaceBook app - a good number of tables, high performance, TDD/BDD essential

	
[done]1. like functionality
		[done]implement a cookie so a use can only vote for each trick once
		[done]turn off tweet/facebook stuff/email
		
[done]2. Text on slider bar, hyperlink in slider bar to details page.. good static images..styley....use own photos?... make slider smaller
	<div class="text bottom">
	<div class="text top">
		http://www.flickr.com/photos/si/2406409/sizes/o/in/photostream/  - Simon Hammond
		http://www.flickr.com/photos/mrlerone/75159252/ - Tony Bradbury
		http://www.flickr.com/photos/fabulousterrah/3336330479/ - Fabulour Terrah
		
		760*451 is the original size of the images


[done]3. Most popular Tabs working

[done]3.2 Take off search box

[done]3.3 put on Google analytics

[done]upload proper verison to Azure
[doing]Send to Phil and Nora

3.5  TDD/BDD focus on the whole site - what can/can't should/shouldn't I test?
			what if URL is wrong?
				
				
	Testing Strategy in MVC3
		look at unit test framework for mvc3
			TDD/BDD MVC3
			
			validation
				TricksSpecs and on view (HTML5)
		
			default values eg Votes = 0
				where to handle
					if the form returns a number as votes, we want to handle it fine
					if the form returns a string with non numberics we want to handle it.
		
			[doing]validation and business logic
				Insert
				Update
					both call isValid.. passing in an expando object
						which clears the errors list - Errors.
						then calls Validate passing in the object
						
						Save calls isValid
			
			****
			Monday
			
			[done]like is calling validator and failing
				because it is doing an update
				
				ID and Votes an int32 when coming from like
					When coming from Create/Update form everything is a string.
					seems like everything works when pass as string into massive and it works it out from there.

			[nope]rename Details
			
			[done]date stuff
				[nope]question on stackoverflow on getting back saved data.
					why is the result of a save not returning back the object that is saved?
				renders okay on front index page and details page.
				and admin index page.'
				and admin edit page
					but fails to update
						comes in from the FormCollection as all strings.
						CreateFrom method makes everything strings.
						
						easiest thing to do is convert from NZ to US date format.
					
				coming out of Massive as a System.DateTime... so this works fine as culture is taken into consideration
				
				
				but when going back into Massive, the form post, everything is a string so have to convert to US
					
				
			Week plan (Tue)
				[done]get working offline - make switch to do it for demos.
					videos in detail
					jquery in app_code
					themes.googleusercontent - home page

				[done]2 new fields in add/edit trick
				
				[done]Text boxes bigger and nicer on backend	
					strip out css for backend make simpler
				
				[done]put in a default picture
					
				[done]Dates on server
				
				[done]delete put in something nice
				
				[done]public to Azure to make sure it works (globalization thing)
				
				[done]diagram of how stuff works - especially types of values being passed
					get a simple mvc3 app talking to massive and new dbasdfasdf
						pass in a string, int, and datetime in a form
						save to db
						pull back out and display
				
				[done]Dates bug
					When adding, and get a validation problem, date reverts to American format.
						Problem - DateCreated is not coming back
						
				**
				[done]dates - business logic not quite right
						change db on live to getdate()
						unit test dates
						live server testing
						
				[no too buggy]bring in Add/Edit roles from project found yesterday
					http://webadvert.codeplex.com/
					Manage Accounts (users)
					Manage Roles
						from here can add users to roles
						
					problem: when add a new user (account/register) it logs you in as that user.
						
				Foreign key complexity
					1 to many
						[done]comments
							[done - need to refactor]put in menu in admin
								important to get looking good
									[done]positioning of header
									font and colour reasonable - just like woothemes
										being picked up from other css thing.
										[didn't work]make differnent class?
										class=nav clashes?
											we want the one in styleAdmin
												changed .nav to .navx in styleAdmin in 2.2
							
									strip back and do in a sample project
									
							[done]how to put in name of trick instead of TrickID?		
							
							put up CRUD - TDD
								how to get recently created entity?
						

							[done]Cant get my dropdown list of data to come through to helper method
									can have Model.DropDownListOfTricks = asdf;
									
									try adding an IEnumerable of expandoobjects to it
								
							[done]problem: how to save the drop down list new value
								
								
							[done]problem: how access the model on ViewResult
								
						
						
					many to many
						categories back end
							[done]get create and edit and delete of category working via TDD/BDD
							
							[done]multiselect inside categories - to add a category to multiple tricks.
								key = "TrickID"
								val = "518,519"
								
							get ones showing up in edit highlighted
							
							edit failing when there are no categories selected on CategoryData.ID
								does not contain a definition for CategoryData
								
							**HERE**	
						
							multiselect inside trick - to add a trick to multiple categories
							http://www.erichynds.com/jquery/jquery-ui-multiselect-widget/
							
								
							
						eg /categories/kids - this is on front end
						
					date picker?
					
					Cruddy controller
				
				use unobtrusive validation against model?
				put render stuff into a .cshtml file

				put on github
				
				facebook like implement
				
				twitter make sure it works
				
				make ASP.Membship tables have different start or ??? differentiate
				
				put in text on footers
				put in theme credits and gplv2 thing

				record demo talk - send to Phil
					start with v.simple overview of MVC3?  Dave?
						What should be in Model
						What should be in Controller
						How stuff is displayed in view
							picture of how query is done and what the types are.

					TDD/BDD what works for me
						where to start
						write tests even if can't fill them in
							
					Validation strategy
					
				[done]watch orm presentation
					
				Testing
					routing testing - what if routing is wrong
					http://bradwilson.typepad.com/blog/2010/07/testing-routing-and-url-generation-in-aspnet-mvc.html
				
				Auto document from Specs
			


-------
Technologies used (in order)
	www.tekpub.com - Real World ASP.NET MVC3
	Unfuddle - project mgt
	Dropbox
	Azure1.5
	MVC3
	Git
	NuGet
	NLog - help to debug easily
	Ninject - keep things decoupled and easy.
	Azure Web deploy
	ASP.NET Membership
	jQuery
	jQuery cycle
	Massive
	MVC Code Templates (T4)
	
	
CodeSmells
	FakeLogger - use DI
	
issues with VidPub
	insert not working properly... hacking massive a problem?
		eg insert a new user doesn't insert password correctly.. wrong number of parameters
---------------
Presentation Notes:
	No net access
	
	keyboard shortcuts stop me if something interests you.
	
	Me:
		What is MVC3 file new proj
		Massive ORM
			a great video free is on:
			
		dynamics in C#4
		tdd/bdd
		pubtricks
		
		
		
		
		
	OtherDave:
		scaffolding
		jqgrid
		unobtrusive validation
		data annotations
		EF repository pattern
	

Why not use Silverlight?	
	